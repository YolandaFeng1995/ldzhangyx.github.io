<!DOCTYPE html>
<html>
<head>
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-126536496-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->


    

    



    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="true">
    
    
    
    
    <title>《Interactive Arrangement of Chords and Melodies Based on a Tree-Structured Generative Model》论文笔记 | 张逸霄的技术小站 | 欢迎RSS订阅我的个人主页！</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="音乐生成,和声">
    <meta name="description" content="京都大学这篇论文很有意思，是ISMIR 2017年同款论文《Function- and Rhythm-Aware Melody Harmonization Based on Tree-Structured Parsing and Split-Merge Sampling of Chord Sequences》的交互版本。基本理论都是一致的，建立了一个PCFG的统计模型。这篇文章我会两个都提到。">
<meta name="keywords" content="音乐生成,和声">
<meta property="og:type" content="article">
<meta property="og:title" content="《Interactive Arrangement of Chords and Melodies Based on a Tree-Structured Generative Model》论文笔记">
<meta property="og:url" content="http://ldzhangyx.github.io/2019/01/22/tree-music/index.html">
<meta property="og:site_name" content="张逸霄的技术小站">
<meta property="og:description" content="京都大学这篇论文很有意思，是ISMIR 2017年同款论文《Function- and Rhythm-Aware Melody Harmonization Based on Tree-Structured Parsing and Split-Merge Sampling of Chord Sequences》的交互版本。基本理论都是一致的，建立了一个PCFG的统计模型。这篇文章我会两个都提到。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://ldzhangyx.github.io/2019/01/22/tree-music/1.png">
<meta property="og:image" content="http://ldzhangyx.github.io/2019/01/22/tree-music/2.png">
<meta property="og:image" content="http://ldzhangyx.github.io/2019/01/22/tree-music/3.png">
<meta property="og:image" content="http://ldzhangyx.github.io/2019/01/22/tree-music/4.png">
<meta property="og:image" content="http://ldzhangyx.github.io/2019/01/22/tree-music/5.png">
<meta property="og:image" content="http://ldzhangyx.github.io/2019/01/22/tree-music/6.png">
<meta property="og:image" content="http://ldzhangyx.github.io/2019/01/22/tree-music/7.png">
<meta property="og:image" content="http://ldzhangyx.github.io/2019/01/22/tree-music/8.png">
<meta property="og:image" content="http://ldzhangyx.github.io/2019/01/22/tree-music/10.png">
<meta property="og:image" content="http://ldzhangyx.github.io/2019/01/22/tree-music/9.png">
<meta property="og:image" content="http://ldzhangyx.github.io/2019/01/22/tree-music/11.png">
<meta property="og:updated_time" content="2019-01-24T11:31:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="《Interactive Arrangement of Chords and Melodies Based on a Tree-Structured Generative Model》论文笔记">
<meta name="twitter:description" content="京都大学这篇论文很有意思，是ISMIR 2017年同款论文《Function- and Rhythm-Aware Melody Harmonization Based on Tree-Structured Parsing and Split-Merge Sampling of Chord Sequences》的交互版本。基本理论都是一致的，建立了一个PCFG的统计模型。这篇文章我会两个都提到。">
<meta name="twitter:image" content="http://ldzhangyx.github.io/2019/01/22/tree-music/1.png">
    
        <link rel="alternate" type="application/atom+xml" title="张逸霄的技术小站" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">张逸霄</h5>
          <a href="mailto:ldzhangyx@outlook.com" title="ldzhangyx@outlook.com" class="mail">ldzhangyx@outlook.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-link"></i>
                关于我
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/ldzhangyx" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                GitHub
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://yixiao-music.github.io" target="_blank" >
                <i class="icon icon-lg icon-users"></i>
                音乐会议Deadline
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">《Interactive Arrangement of Chords and Melodies Based on a Tree-Structured Generative Model》论文笔记</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">《Interactive Arrangement of Chords and Melodies Based on a Tree-Structured Generative Model》论文笔记</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-01-22T07:13:00.000Z" itemprop="datePublished" class="page-time">
  2019-01-22
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/论文笔记/">论文笔记</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#摘要"><span class="post-toc-number">1.</span> <span class="post-toc-text">摘要</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Introduction"><span class="post-toc-number">2.</span> <span class="post-toc-text">Introduction</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#相关工作"><span class="post-toc-number">3.</span> <span class="post-toc-text">相关工作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Harmonization（协调）"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">Harmonization（协调）</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#音乐语言建模（Music-Language-Modeling）"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">音乐语言建模（Music Language Modeling）</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#概率建模"><span class="post-toc-number">4.</span> <span class="post-toc-text">概率建模</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#模型形式化"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">模型形式化</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#贝叶斯学习"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">贝叶斯学习</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Harmonization"><span class="post-toc-number">5.</span> <span class="post-toc-text">Harmonization</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#问题定义"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">问题定义</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Metropolis-Hasting采样"><span class="post-toc-number">5.2.</span> <span class="post-toc-text">Metropolis-Hasting采样</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#更新和弦符号"><span class="post-toc-number">5.3.</span> <span class="post-toc-text">更新和弦符号</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Viterbi算法"><span class="post-toc-number">5.3.1.</span> <span class="post-toc-text">Viterbi算法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#分裂-合并操作"><span class="post-toc-number">5.3.2.</span> <span class="post-toc-text">分裂-合并操作</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#更新和弦节奏"><span class="post-toc-number">5.4.</span> <span class="post-toc-text">更新和弦节奏</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Evaluation"><span class="post-toc-number">6.</span> <span class="post-toc-text">Evaluation</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#实验准备"><span class="post-toc-number">6.1.</span> <span class="post-toc-text">实验准备</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#评估旋律预测的能力"><span class="post-toc-number">6.2.</span> <span class="post-toc-text">评估旋律预测的能力</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#评估和弦序列的预测能力"><span class="post-toc-number">6.3.</span> <span class="post-toc-text">评估和弦序列的预测能力</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#生成样本的讨论"><span class="post-toc-number">6.4.</span> <span class="post-toc-text">生成样本的讨论</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#结论"><span class="post-toc-number">7.</span> <span class="post-toc-text">结论</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#想法"><span class="post-toc-number">8.</span> <span class="post-toc-text">想法</span></a></li></ol>
        </nav>
    </aside>


<article id="post-tree-music"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">《Interactive Arrangement of Chords and Melodies Based on a Tree-Structured Generative Model》论文笔记</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-01-22 15:13:00" datetime="2019-01-22T07:13:00.000Z"  itemprop="datePublished">2019-01-22</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/论文笔记/">论文笔记</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>京都大学这篇论文很有意思，是ISMIR 2017年同款论文《Function- and Rhythm-Aware Melody Harmonization Based on Tree-Structured Parsing and Split-Merge Sampling of Chord Sequences》的交互版本。基本理论都是一致的，建立了一个PCFG的统计模型。这篇文章我会两个都提到。</p>
<a id="more"></a>
<h1 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h1><p>本文提出了一个harmonization方法。给定一个旋律（音符序列），输出一系列和弦符号。典型的方式使用了HMM，但不能明确表现节奏、和弦结构、和弦功能。所以本文提出了一个分层生成模型，包括：</p>
<ol>
<li>PCFG生成和弦</li>
<li>韵律（metrical）马尔可夫模型生成节奏（强弱关系，同时也是和弦边界）</li>
<li>在和弦条件下的马尔可夫旋律生成</li>
</ol>
<p>为了估计给定旋律的可变长度和弦序列，作者使用了具有分裂、合并操作的Metropolis-Hastings采样器迭代地细化潜在树结构和和弦符号和节奏。实验结果表明，该方法在预测能力方面优于基于HMM的方法。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="1.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>和弦序列的创建在音乐构成和排列中起关键作用，因为和声影响音乐的情绪并且表征某种音乐风格的印象。我们的目标是自动旋律协调，或为给定旋律（一系列音符）自动生成一系列和弦符号。在本文中，我们将注意力集中在流行音乐风格的协调问题上。我们采用统计方法自动学习音乐语料库中的模型架构和参数，并根据数据的风格进行协调，而不是手动描述爵士乐和古典音乐等风格的音乐理论。我们制定了一个概率模型，表示和弦序列的生成可能性和另一个代表在和弦序列上有条件地产生旋律的可能性的模型。</p>
<p>和弦序列通常由马尔可夫模型描述。常用的方法是，使用一个有潜在马尔可夫链的HMM模型，假定旋律在这个和弦上生成。但是这个方法的缺点在于忽略了和弦的句法角色和层次结构。在传统的和声理论中，这种句法角色通常被称为调和函数，包括三类（例如，主音（tonic，第一音级），属音（dominant，第五音级）和下属音（subdominant，第四音级）），它们类似于语言学理论中的词性。</p>
<p>举个例子，一个和弦序列(C, Dm, G, Am, C, F, G, C)，可以被解释成：(((T, SD),(D, T)), ((T, SD), (D, T)))。因此，当我们计算地帮助人们创造新音乐时，期望考虑这种和弦序列的分层树结构。</p>
<p>传统HMM的另一个问题在于和弦节奏（起始分数时间或和弦持续时间）的描述。由于和弦持续时间是通过常规时间网格（例如，节拍或条形网格）上的自转移概率来描述的，因此未明确描述和弦节奏。</p>
<p>模型中PCFG的使用收到了Steedman工作的启发（1984年）。这个工作提出了使用上下文无关语法CFG来表示和弦的层次结构。本文研究的一个关键优势是，PCFG的规则概率和树结构可以以无监督的方式从和弦序列语料库中进行联合估计，期待和弦的句法角色被那些非终结符（non-terminal）捕获。</p>
<p>韵律马尔可夫模型用于明确地描述后续和弦之间，起始节拍位置的转换概率。</p>
<p>在这个树状分层生成模型，本文提出了一个统计的harmonization方法，基于具有split、merge操作的复杂的Metropolis-Hasting采样器。为了估计具有适合于给定旋律的和弦节奏的可变长度和弦序列，我们随机地从它们的后验分布中搜索最可能的潜在树结构，符号和和​​弦的起始时间。在这个搜索中，我们的采样器有四种类型的建议：</p>
<ol>
<li>使用Viterbi算法的变体，更新整个latent树结构。</li>
<li>其中一个和弦被分开。</li>
<li>两个相邻的和弦根据latent树结构合并。</li>
<li>其中一个和弦的开始时间来回移动。</li>
</ol>
<p>这种随机的全局或局部更新可以被解释为寻找最佳和弦序列的重复试错过程。</p>
<h1 id="相关工作"><a href="#相关工作" class="headerlink" title="相关工作"></a>相关工作</h1><h2 id="Harmonization（协调）"><a href="#Harmonization（协调）" class="headerlink" title="Harmonization（协调）"></a>Harmonization（协调）</h2><p>Harmonization的研究有两个方向：生成和弦，或者直接生成若干个音（比如说组成和弦的四个音）。</p>
<p>第一个方向有这些研究：</p>
<ol>
<li>用支持向量机（SVM）从给定旋律中选择和弦音（和弦的构成音），从和弦音构造三和弦，以及通过rule-base方法生成和弦行进。</li>
<li>基于HMM的方法，和弦转换由马尔可夫模型描述。该方法已在MySong中实现。</li>
<li>提出了类似的马尔可夫模型，其中和弦由旋律和时变键来调节。</li>
</ol>
<p>第二个方向：</p>
<ol>
<li>基于规则的方法，用于生成巴赫风格的四部分合唱。</li>
<li>使用基于音乐理论的遗传算法（GA）变体。</li>
<li>基于HMM的方法，该方法将和弦表示为隐藏状态，将音符表示为观察输出。</li>
<li>隐半马尔可夫模型（HSMM）用于明确表示和弦的持续时间。</li>
<li>分层树形结构模型，它通过划分和弦的符号从分层时标的角度描述和弦运动。</li>
</ol>
<h2 id="音乐语言建模（Music-Language-Modeling）"><a href="#音乐语言建模（Music-Language-Modeling）" class="headerlink" title="音乐语言建模（Music Language Modeling）"></a>音乐语言建模（Music Language Modeling）</h2><p>根据《Generative Theory of Tonal Music》（GTTM），音符序列被假定有了分层的结构，描述了哪些音符是重要的音符。这个理论包括了一个规则，可以将音符序列递归地减少到一个音符。这个理论已经有了其计算实现。基于PCFG的GTTM概率公式已经被提出了，并且可以直接从音符序列中无监督地学习产生式。</p>
<p>用于和弦序列地各种语言模型，在音乐音频信号处理、音乐分析、音乐排列（Arrangement）中也被充分研究。</p>
<p>传统语言模型是n-gram语言模型。同时为了避免n较大带来的稀疏问题，也有平滑方法解决。Yoshii提出了一个vocabulary-free的infinity-gram模型，每个和弦取决于其可变长度的和弦历史。</p>
<p>也有研究引入了几个隐藏的状态转换层，代表和弦的层次结构。</p>
<p>一些研究明确使用了生成语法来表示和弦的层次结构。Steedman和Rohimeier提出了和弦序列的产生式（production rules）描述。之后其概率扩展也被研究，且已经进行了概率的无监督学习。</p>
<p>这些产生式列表和非终结符（non-terminals）是根据音乐理论和经验给出的。</p>
<h1 id="概率建模"><a href="#概率建模" class="headerlink" title="概率建模"></a>概率建模</h1><p>用于和弦符号的PCFG通过来自和弦序列语料库的无监督学习来训练，同时估计背后的latent树结构。用于和弦节奏的韵律马尔可夫模型来自包括和弦节奏的语料库的监督学习来训练。音调序列的马尔可夫模型也通过来自旋律和和弦序列的配对数据的监督学习来训练。</p>
<h2 id="模型形式化"><a href="#模型形式化" class="headerlink" title="模型形式化"></a>模型形式化</h2><p>约定下面符号：</p>
<p>和弦总体用$z$表示.假设共有N个和弦符号，那么第n个和弦符号记为$z_n$。</p>
<p>和弦开始的时间总体用$\phi$表示（16分音符为单位时间）。N个值与N个和弦一一对应，所以第n个开始时间记为$\phi_n$。</p>
<p>将$x$记为旋律总体。在第n个和弦范围里，旋律序列可以用$x_n$表示。由于一个和弦可以有多个音符序列，所以其中第i个音符使用$x_{ni}$表示。</p>
<p>音符也需要控制其长度（确定开始时间）。将开始时间的总体记为$\psi$。所以第n个和弦范围内的开始时间序列也记为$\psi_n$。其中第i个音符的开始时间记为$\psi_{ni}$。</p>
<p>（说实话原文表示得比这个难懂多了……剩下的表示也非常勉强）</p>
<p>如果每小节（measure/bar）长度为L，那么$\phi$和$\psi$的取值范围为$[0, 16L-1]$（以16分音符为单位长度）。</p>
<p>那么概率上下文无关文法（PCFG）被定义为：</p>
<script type="math/tex; mode=display">G = (V, \Sigma, R, S )</script><p>其中$V$为非终结符集合，$\Sigma$为终结符集合，$R$为推导式集合，$S$为起始变量。</p>
<p>概率规则在这里有三种形式：</p>
<ol>
<li><p>A分裂为BC（不同的BC带来概率）：</p>
<script type="math/tex; mode=display">\mathbf{\theta_A} = \{\theta_{A\rightarrow BC}\}_{B,C \in V}</script></li>
<li><p>A转换成非终结符$\alpha$（不同的$\alpha$带来概率）：</p>
</li>
</ol>
<script type="math/tex; mode=display">\mathbf{\eta_A} = \{\eta_{A\rightarrow \alpha}\}_{\alpha \in \Sigma}</script><ol>
<li>A有几率分裂，也有几率转换为终结符。将其转换为终结符地概率记为$\lambda_A$。</li>
</ol>
<p>韵律马尔可夫模型表述了和弦开始的时间点的转移概率：</p>
<script type="math/tex; mode=display">p(\phi_n|\phi_{n-1}) = \pi_{\bar{\phi}_{n-1},\bar{\phi}_{n}}</script><p>其中，$\phi_n$代表第n个和弦开始的时间点，而$\bar{\phi}_{n} = \phi_n \mod 16$，且$\pi_{ab}$代表了从beat position的转移概率（没太明白）。</p>
<p>最后音乐生成的马尔可夫模型，是基于和弦进行的还原。</p>
<script type="math/tex; mode=display">
p(x_{nm}|x_{nm-1}, z_n) = \tau^{z_n}_{x_{nm-1}x_{nm}}</script><p>这个公式决定了从一个音符跳到另一个音符的转移概率。</p>
<p>我们在这些PCFG的参数上施加共轭先验（先验分布=后验分布），以保证和弦不会对旋律产生冲突：</p>
<script type="math/tex; mode=display">
\theta_A \sim Dirichlet(\xi_A) \\
\eta_A \sim Dirichlet(\zeta_A) \\
\lambda_A \sim Beta(\iota_a)</script><p>（什么玩意儿……我也不熟贝叶斯估计啊……）</p>
<p>三个参数均为超参数。相同地，对和弦边界的马尔可夫模型：</p>
<script type="math/tex; mode=display">
\pi_a \sim Dirichlet(\beta) \\
\tau_x^z \sim Dirichlet(\gamma)</script><p>相似地，我们也要建立一个旋律生成模型。这个旋律生成模型的边界类似于和弦的边界，但是作为协调模型，旋律作为输入进行处理。</p>
<p>当然也可以使用LSTM进行旋律生成：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="2.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h2 id="贝叶斯学习"><a href="#贝叶斯学习" class="headerlink" title="贝叶斯学习"></a>贝叶斯学习</h2><p>我们通过最大后验（MAP）估计获得模型参数$\Theta = {\theta, \eta, \lambda, \pi, \tau}$。使用一种内部滤波-外部采样（inside-filtering-outside-sampling，2007年被提出）的算法进行Gibbs采样变体。</p>
<p>假设和弦序列$z$是从latent树$t$中导出的，那么$t$可以有一组非终结节点${t_{n:m}}_{1 \leq n \leq m \leq N}$，其中$t_{n:m}$是根节点。这样可以导出从n到m的所有和弦$z_{n:m} = {z_n, z_{n+1}, …, z_m}$。这个latent树$t$和参数$\theta, \eta, \lambda$采用条件后验分布$p(t|\theta, \eta, \lambda,z)$和$p(\theta, \eta, \lambda| t,z)$进行交替的采样。</p>
<p>这个算法可以从正确的后验分布$p(t,\theta, \eta, \lambda|z)$中得到$t,\theta, \eta, \lambda$这四个参数的样本。</p>
<p>在内部滤波阶段，我们集中于一个条件概率，从树导出和弦：</p>
<script type="math/tex; mode=display">
p_{nm}^A = p(z_{n:m}|t_{n:m} = A)</script><p>这个概率可以递归地从叶节点到根节点进行逐步计算：</p>
<script type="math/tex; mode=display">
p_{nm}^A = \lambda_A\eta_A \rightarrow z_n, \\
p^A_{n,n+k} = \sum_{B,C \in V}[(1-\lambda_A)\theta_{A \rightarrow BC}\sum_{1 \leq l \leq k}p^B_{n,n+l-1}p^C_{n+l,n+k}]</script><p>在外部采样地步骤，我们递归地采样一个latent树，从开始符号$S$到叶节点，使用内部概率$p(t|\theta, \eta, \lambda,z)$。当节点$t_{n:n+k} = A$已经被采样，那么这个节点分裂到的$B, C$可以这么采样：</p>
<script type="math/tex; mode=display">
p(l,B,C) = p(t_{n:n+l-1} = B, t_{n+l:n+k} = C | t_{n:n+k} = A, z_{n:n+k}) \\
= (1-\lambda_A)\theta_{A \rightarrow BC} p^B_{n,n+l-1}p^C_{n+l,n+k}/p^A_{n,n+k}</script><p>其中$l$就是分裂点。</p>
<p>最后，采样$\theta, \eta, \lambda$，根据公式：</p>
<script type="math/tex; mode=display">
p(\theta, \eta, \lambda| t,z) = p(\theta|t,z)p(\eta|t,z)p(\lambda|t,z)</script><p>给定：</p>
<script type="math/tex; mode=display">
\theta_A \sim Dirichlet(\xi_A + u_A) \\
\eta_A \sim Dirichlet(\zeta_A + v_A) \\
\lambda_A \sim Beta(\iota_a + w_A)</script><p>其中，$u_{A\rightarrow BC}(v_A \rightarrow \alpha)$ 是对应产生式对$t$调用的次数，而$w_{A,0}(w_{A,1})$是非终结符$A$分裂（代换为终结符）和$t$的次数。（原文如此）</p>
<p>马尔可夫模型的学习是通过监督学习完成的。因为Dirichlet分布和分类分布之间的共轭性，参数很容易学习到。</p>
<h1 id="Harmonization"><a href="#Harmonization" class="headerlink" title="Harmonization"></a>Harmonization</h1><h2 id="问题定义"><a href="#问题定义" class="headerlink" title="问题定义"></a>问题定义</h2><p>给定一个旋律序列，包括音高$x$，音高开始时间序列$\psi$，训练好的模型参数$\Theta$，估计一个可变长度和弦序列$z$及其开始时间序列$\phi$，以及一个latent树$t$。</p>
<h2 id="Metropolis-Hasting采样"><a href="#Metropolis-Hasting采样" class="headerlink" title="Metropolis-Hasting采样"></a>Metropolis-Hasting采样</h2><p>使用MH采样生成$t,z,\phi$，通过后验分布$p(t,z,\phi|x,\psi,\Theta)$，基于下面四个proposals:</p>
<ul>
<li>全局更新：更新和弦序列和latent树，保持和弦数量和开始时间不变</li>
<li>分裂</li>
<li>合并</li>
<li>节奏更新：移动一个和弦的开始时间 </li>
</ul>
<p>虽然使用内部滤波-外侧采样算法进行全局更新更为合适，但Viterbi算法用于后验空间的有效优化。</p>
<p>在MH采样中，随机选取其中一个proposal，将</p>
<script type="math/tex; mode=display">
s = (t,z,\theta)</script><p>转化到</p>
<script type="math/tex; mode=display">
s^* = (t,z,\theta)^*</script><p>计算接受率，来判断$s^*$是否接受为下一个样本：</p>
<script type="math/tex; mode=display">
g(s^*,s) = min\{1, \frac{p(s^*)p(s|s^*)}{p(s)p(s^*|s)}\}</script><p>我们通过迭代MH采样足够次数来估计最合理的$z$和$\phi$，然后获得最大化完整数据可能性的潜在变量。</p>
<h2 id="更新和弦符号"><a href="#更新和弦符号" class="headerlink" title="更新和弦符号"></a>更新和弦符号</h2><h3 id="Viterbi算法"><a href="#Viterbi算法" class="headerlink" title="Viterbi算法"></a>Viterbi算法</h3><p>这里执行的是全局更新：$p(t,z,\phi|x,\psi,\Theta)$。</p>
<p>使用的并不是标准Viterbi算法，因为$t,z$都是需要估计的隐变量。</p>
<p>首先从最底层的和弦序列$z$，到根节点$S$递归计算内部概率：</p>
<script type="math/tex; mode=display">
p_{nn}^A = \lambda_A\max_{c \in \Sigma}\eta_{A \rightarrow c}p(x_n|c)^{1/I_n}, \\
p^A_{n,n+k} = (1-\lambda_A)\max_{B,C \in V, l \in [1,k]}\theta_{A \rightarrow BC}\sum_{1 \leq l \leq k}p^B_{n,n+l-1}p^C_{n+l,n+k}</script><p>其中$p(x_n|c)$是第n个和弦范围里的音高概率：</p>
<script type="math/tex; mode=display">
p(x_n|z_n) = p(x_{n1}|z_n)p(x_{n2}|x_{n1}z_n)...p(x_{nI_n}|x_{n,I_{n}-1}z_n)</script><p>最可能的$t,z$通过回溯最佳路线得到。</p>
<h3 id="分裂-合并操作"><a href="#分裂-合并操作" class="headerlink" title="分裂-合并操作"></a>分裂-合并操作</h3><p>分割操作与合并操作是相反的操作。</p>
<p>为了得到新状态$s^*$，在分割操作中，随机选择一个和弦$z_n$，将其分割为$z^L$和$z^R$，选择新的开始时间在$[\phi_n + 1, \phi_{n+1} - 1]$，同时将非终结符$t_{n:n}$分割为$t^L, T^R$。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="3.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>合并操作，选择一对相邻和弦进行操作：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="4.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>其中$#MergeableNodes(s^*)$指可以在这个状态里合并的和弦对的数量。</p>
<p>两个概率的似然比：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="5.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>通过上述三个式子，可以计算$s^*$的接受率。</p>
<p>图为示意操作：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="6.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h2 id="更新和弦节奏"><a href="#更新和弦节奏" class="headerlink" title="更新和弦节奏"></a>更新和弦节奏</h2><p>更新和弦节奏的前提是其他的因素都固定下来了：$p(\phi|t,z,x,\psi,\Theta)$。</p>
<p>给出相关公式：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="7.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="8.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h1 id="Evaluation"><a href="#Evaluation" class="headerlink" title="Evaluation"></a>Evaluation</h1><h2 id="实验准备"><a href="#实验准备" class="headerlink" title="实验准备"></a>实验准备</h2><p>从SALAMI数据集（McGill公开的一个音乐标注数据集）中提取和弦序列，长度从8到32的序列被选择。和弦符号仍被分为25个大小调标记。</p>
<p>为了以有监督的方式训练两个马尔可夫模型，从Rock Corpus中提取了9902对旋律和对应和弦序列。</p>
<p>在测试阶段，使用了RWC音乐数据集，用于评估。</p>
<p>所有数据都被转换到C大（小）调。</p>
<h2 id="评估旋律预测的能力"><a href="#评估旋律预测的能力" class="headerlink" title="评估旋律预测的能力"></a>评估旋律预测的能力</h2><p>为了根据旋律预测的能力评估PCFG分层生成模型，我们计算了从RWC音乐数据库中提取的旋律的边际似然性。</p>
<p>非终结符的种类数（或PCFG的复杂度）K，从1变为20。在K的每种情况下，我们通过Gibbs采样获得不同的PCFG参数，并计算每个参数集的边际似然。根据计算复杂性，不同参数集的数量在37和50之间。我们假设和弦开始与小节线完全同步，使得和弦序列在分析上被边缘化。</p>
<p>将所提出的模型与HMM进行比较，该HMM学习相邻单元之间的和弦符号转换，（相邻单元是）音符或小节。当最小时间单位是音符时，假设每个音符在当时的和弦符号上有条件地生成。当最小时间单位是小节时，假设伴随每个和弦的音符是根据旋律马尔可夫模型生成的。</p>
<p>每一个音符的边缘似然值：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="10.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<h2 id="评估和弦序列的预测能力"><a href="#评估和弦序列的预测能力" class="headerlink" title="评估和弦序列的预测能力"></a>评估和弦序列的预测能力</h2><p>与标签的比较结果见下图：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="9.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>所提出的模型16.6％优于基于HMM的方法。虽然一定范围的K显示出比基于HMM的方法高得多的准确度（例如，26％），但是K与准确度的中值之间几乎没有相关性。</p>
<h2 id="生成样本的讨论"><a href="#生成样本的讨论" class="headerlink" title="生成样本的讨论"></a>生成样本的讨论</h2><p>下图显示了具有分裂、合并操作的MH采样方法如何进行harmonization:</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="11.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>问题依然存在。这个方法更倾向于生成简单的和弦，原因是因为优化使用了Viterbi算法。此外，实验中得出的和弦序列数量往往不高于最初采样的初始化数量，因为拆分比合并接受率更低。</p>
<h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>本文提出了一种harmonization方法，根据隐藏在流行音乐语料库中的音乐规则，为给定的旋律生成可变长度的和弦序列。实验结果表明，所提出的模型在预测能力方面优于基于HMM的方法，并且具有很大的作曲、编曲潜力。<br>由于我们的方法基于统计学习，因此发现它更喜欢更简单和基本的和弦序列。更具体地，产生的和弦的数量倾向于小于小节的数量。这个问题可以通过为MCMC采样中的拆分操作提供更多机会来解决。为了增加所生成的和弦符号的多样性，sampling或beam search方法被认为是有效的，而不是viterbi算法——其倾向于从统计观点找到具有最高后验概率的流行和弦序列。<br>我们还需要进一步研究我们的模型。在本文中，一个4/4拍的小节被分为16个时间单位。因此，研究最佳时间分辨率并扩展模型以处理其他拍子的音乐类型非常重要。此外，为了评估生成的和弦序列的音乐适应性，我们计划进行基于调查的听力测试，并评估我们的模型与音乐理论或音乐直觉的一致性。</p>
<p>（他们在2018版的确做了一个详尽的测试评估）</p>
<h1 id="想法"><a href="#想法" class="headerlink" title="想法"></a>想法</h1><p>这个论文过于硬核，以至于我不知道从哪里开始说起……首先值得称道的是使用PCFG文法来表达和弦的分层结构。这个实验室这几年真是对这个idea疯狂灌水，各个顶会和期刊都灌了个遍。但是这个idea，也就是运用乐理来对和弦进行树状分析和生成，是值得称道的。</p>
<p>那么这篇论文最硬核和晦涩的点在于对这个层次关系树的训练。如果用替代的方法构建这棵树（比如只捕捉相邻关系），结果将会好做很多。</p>
<p>而且这篇论文的可读性是真的很差了……</p>
<p>另外这个计算和谐程度的方法很有意思，有一点VAE的影子，从高维到低维，再还原。这样的低维流形可以用图网络去学习吗？我觉得是一个非常有趣的点。</p>
<p>另外，</p>
<p>这段时间比较忙，没有顾着更新。然后各个方面发展有些停滞不前，研究院这边的联系、申请的事情，这些都是需要操心的事。更加迷的是，最近看了那篇《Counterpoint by Convolution》，里面叙述的一个无序模型十分令人费解；还有夏老师前段时间的《A Framework for Automated Pop-song Melody Generation with Piano Accompaniment Arrangement》，也是蛮复杂的，不过后面这篇主要是叙事节奏太快，几页纸讲完了一个编曲系统，令人有些迷糊。</p>
<p>最近也有些新启发。前段时间入手的《完全音乐理论教程》，Laitz的那本。仔细研读这本书（当然还没读完），我对对位法写作和调性音乐有了更加深度的认识。目前我觉得，乐理肯定是复调音乐写作的钥匙。我就这个问题问过Prof. Pasquier，关于乐理在实际音乐生成中的位置，他回应说一些关键的点依旧是人工定义的。类比罗塞塔石碑，不同的语言在同一块石板上，音乐生成任务也可以借鉴乐理知识作为一个重要依据。那么音乐生成就极有意思了。目前的音乐生成实际上是分为了流行音乐和复调音乐两大块，其融合的一个点可能就是夏老师上面那篇论文，用统一的方式生成主旋律、伴奏、分解和弦。流行音乐中，如何生成和弦走向、如何确定鲜明的旋律，如何保证旋律连贯性，都是需要保证的；而复调音乐中需要考虑的也有很多，包括音程关系，对位法规则等等。这些都是值得探索的。</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-01-24T11:31:00.000Z" itemprop="dateUpdated">2019-01-24 19:31:00</time>
</span><br>


        
        原文地址：<a href="/2019/01/22/tree-music/" target="_blank" rel="external">http://ldzhangyx.github.io/2019/01/22/tree-music/</a>
        
    </div>
    
    <footer>
        <a href="http://ldzhangyx.github.io">
            <img src="/img/avatar.jpg" alt="张逸霄">
            张逸霄
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/和声/">和声</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/音乐生成/">音乐生成</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://ldzhangyx.github.io/2019/01/22/tree-music/&title=《《Interactive Arrangement of Chords and Melodies Based on a Tree-Structured Generative Model》论文笔记》 — 张逸霄的技术小站&pic=http://ldzhangyx.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://ldzhangyx.github.io/2019/01/22/tree-music/&title=《《Interactive Arrangement of Chords and Melodies Based on a Tree-Structured Generative Model》论文笔记》 — 张逸霄的技术小站&source=京都大学这篇论文很有意思，是ISMIR 2017年同款论文《Function- and Rhythm-Aware Melody Harmonization..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://ldzhangyx.github.io/2019/01/22/tree-music/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《《Interactive Arrangement of Chords and Melodies Based on a Tree-Structured Generative Model》论文笔记》 — 张逸霄的技术小站&url=http://ldzhangyx.github.io/2019/01/22/tree-music/&via=http://ldzhangyx.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://ldzhangyx.github.io/2019/01/22/tree-music/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2019/02/18/rss-recommend/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">个人向RSS订阅列表，以及极简RSS配置指南</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/12/26/structure-encoding-music/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">《The Effect of Explicit Structure Encoding of Deep Neural Networks for Symbolic Music Generation》论文笔记</h4>
      </a>
    </div>
  
</nav>



    

















</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        非常感谢~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>张逸霄 &copy; 2017 - 2019</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://ldzhangyx.github.io/2019/01/22/tree-music/&title=《《Interactive Arrangement of Chords and Melodies Based on a Tree-Structured Generative Model》论文笔记》 — 张逸霄的技术小站&pic=http://ldzhangyx.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://ldzhangyx.github.io/2019/01/22/tree-music/&title=《《Interactive Arrangement of Chords and Melodies Based on a Tree-Structured Generative Model》论文笔记》 — 张逸霄的技术小站&source=京都大学这篇论文很有意思，是ISMIR 2017年同款论文《Function- and Rhythm-Aware Melody Harmonization..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://ldzhangyx.github.io/2019/01/22/tree-music/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《《Interactive Arrangement of Chords and Melodies Based on a Tree-Structured Generative Model》论文笔记》 — 张逸霄的技术小站&url=http://ldzhangyx.github.io/2019/01/22/tree-music/&via=http://ldzhangyx.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://ldzhangyx.github.io/2019/01/22/tree-music/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJklEQVR42u3aQY7jMAwEwPn/p7PA3AaLeLtFZTGWS6cgdmxVDgRF8usrXq/v9ffnd1ff3bN2ddvCwMC4LeN1ua43OtnW9fPzvWFgYDyH0b7mOgS/I+16MgYGBkb+gnxzedKJgYGBMQ+4SQKXnDGTqxgYGBjtITb5fteR9YNncQwMjBsyJo2BT3/+T/0NDAyMX8x4DVYCngT0YicYGBhHM67HI/IQnKSJ7Z/Sth8wMDCewJiU0pLiXV5cW3wXBgbG0Yx8E3sHyJKQWjQGMDAwHsxIXt9maNfPycFFwMXAwDiIkWPmLYRrRtsixcDAOJUxKc0ngLaR0CaRP/obGBgYhzLaxGstyVubl2jTRwwMjLMZu0Yl5glie6zd0F/FwMD49Yz8MNkOVawlf4uhGQMD4wGMtlm4rapX/ilRIoiBgXEoIw9/a/fXoxJtQwIDA+NoRnJEnG+9Ld4l1KJqiIGBcXPGroJXntJ94l0YGBhnM0Y/GwxM5ME0aVRgYGBgtE3KtgyXtweiAQsMDIwHMNoy/WIpf4yPRi4wMDAOYiThL0/48qRw0uyMbsXAwDiC8SpX/ts2pK6xo8YABgbGzRltsMtD86RJOX8CBgbGeYy10Nk2L+el/3/89xgYGA9gTAJf2yqoz9ZJMQ4DAwMjvmcyurE2nIGBgYHRDmRMUsN2OAMDA+NpjLViffu0tgnxkbM4BgbGDRltY2Ctz7DWHN2QMmJgYNyb8QejwmC+t1ZCFwAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdnjs.cloudflare.com/ajax/libs/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'Yixiao Zhang's Website';
            clearTimeout(titleTime);
        } else {
            document.title = 'Yixiao Zhang's Website';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>
