<!DOCTYPE html>
<html>
<head>
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-126536496-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<!-- End Google Analytics -->


    

    



    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="true">
    
    
    
    
    <title>利用networkx进行二叉树可视化 | 张逸霄的技术小站 | 欢迎RSS订阅我的个人主页！</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#7890D2">
    
    
    <meta name="keywords" content="python,MIR,networkx,structure">
    <meta name="description" content="画一棵二叉树。附可执行的Python代码。">
<meta name="keywords" content="python,MIR,networkx,structure">
<meta property="og:type" content="article">
<meta property="og:title" content="利用networkx进行二叉树可视化">
<meta property="og:url" content="http://ldzhangyx.github.io/2020/01/13/binary-tree/index.html">
<meta property="og:site_name" content="张逸霄的技术小站">
<meta property="og:description" content="画一棵二叉树。附可执行的Python代码。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://ldzhangyx.github.io/2020/01/13/binary-tree/5.png">
<meta property="og:image" content="http://ldzhangyx.github.io/2020/01/13/binary-tree/6.png">
<meta property="og:image" content="http://ldzhangyx.github.io/2020/01/13/binary-tree/7.png">
<meta property="og:image" content="http://ldzhangyx.github.io/2020/01/13/binary-tree/8.png">
<meta property="og:updated_time" content="2020-01-13T07:36:18.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="利用networkx进行二叉树可视化">
<meta name="twitter:description" content="画一棵二叉树。附可执行的Python代码。">
<meta name="twitter:image" content="http://ldzhangyx.github.io/2020/01/13/binary-tree/5.png">
    
        <link rel="alternate" type="application/atom+xml" title="张逸霄的技术小站" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/icon.png">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">张逸霄</h5>
          <a href="mailto:ldzhangyx@outlook.com" title="ldzhangyx@outlook.com" class="mail">ldzhangyx@outlook.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/pubs"  >
                <i class="icon icon-lg icon-book"></i>
                论文列表
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/community"  >
                <i class="icon icon-lg icon-microphone"></i>
                社群活动
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/ldzhangyx" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                GitHub
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about"  >
                <i class="icon icon-lg icon-link"></i>
                关于我
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/123"  >
                <i class="icon icon-lg icon-minuss"></i>
                --------------------
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://yixiao-music.github.io" target="_blank" >
                <i class="icon icon-lg icon-music"></i>
                音乐会议Deadline
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/abc"  >
                <i class="icon icon-lg icon-play"></i>
                ABCjs在线渲染工具
              </a>
            </li>
        
      </ul>
    </div>

    <a class="twitter-timeline" href="https://twitter.com/Yixiao_Zhang_?ref_src=twsrc%5Etfw"
    data-height="300">
      Tweets by Yixiao_Zhang_</a> 
      <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">利用networkx进行二叉树可视化</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">利用networkx进行二叉树可视化</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-01-13T15:36:18.000Z" itemprop="datePublished" class="page-time">
  2020-01-13
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/开发笔记/">开发笔记</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#如何绘画一棵二叉树？"><span class="post-toc-number">1.</span> <span class="post-toc-text">如何绘画一棵二叉树？</span></a></li></ol>
        </nav>
    </aside>


<article id="post-binary-tree"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">利用networkx进行二叉树可视化</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-01-13 15:36:18" datetime="2020-01-13T15:36:18.000Z"  itemprop="datePublished">2020-01-13</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/开发笔记/">开发笔记</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>画一棵二叉树。附可执行的Python代码。</p>
<a id="more"></a>
<h1 id="如何绘画一棵二叉树？"><a href="#如何绘画一棵二叉树？" class="headerlink" title="如何绘画一棵二叉树？"></a>如何绘画一棵二叉树？</h1><p>NLP领域句法树的绘画，和音乐结构二叉树的绘画，都希望能有一个unlabel的二叉树绘画库，表现出下图中类似的效果：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="5.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="6.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>我目前没有找到一个通行的包来支持这样的二叉树生成，所以我自己写了一个类似的低配版：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="7.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>这个函数的输入是一个嵌套列表。我设计函数以中序树的方式读取列表。这个类依托于networkx库进行生成。</p>
<p>首先简单说一下原理。我开源的两个demo project:</p>
<ul>
<li><a href="https://github.com/ldzhangyx/diora-for-music-structure" target="_blank" rel="noopener">https://github.com/ldzhangyx/diora-for-music-structure</a></li>
<li><a href="https://github.com/ldzhangyx/Unsupervised-Music-Structure-Extraction-via-Ordered-Neurons" target="_blank" rel="noopener">https://github.com/ldzhangyx/Unsupervised-Music-Structure-Extraction-via-Ordered-Neurons</a></li>
</ul>
<p>最后parse得到的二叉树都是这么表示的：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="8.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>其中，rest用” “表示，而sustain用”-“表示。pitch已经使用pretty_midi转为了音名。</p>
<p>首先中序遍历整个列表。如果当前元素是列表则访问左孩子，如果当前元素是音符，则纪录叶子。使用递归的方式实现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">list_to_tree</span><span class="params">(self, input, layer)</span>:</span>  <span class="comment"># 递归地添加所有节点，做成中序树</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(input, list) <span class="keyword">and</span> layer &lt; self.depth_limit:  <span class="comment"># 当前节点不是叶节点 ，或深度没有到达限制</span></span><br><span class="line">        left_node = self.list_to_tree(input[<span class="number">0</span>], layer + <span class="number">1</span>)  <span class="comment"># 左子树，返回子树的root</span></span><br><span class="line">        current_node = self.add_node(layer, tag=<span class="keyword">None</span>)  <span class="comment"># 当前节点</span></span><br><span class="line">        right_node = self.list_to_tree(input[<span class="number">1</span>], layer + <span class="number">1</span>)  <span class="comment"># 右子树，返回子树的root</span></span><br><span class="line">        self.graph.add_edge(left_node, current_node)</span><br><span class="line">        self.graph.add_edge(right_node, current_node)</span><br><span class="line">    <span class="keyword">elif</span> <span class="keyword">not</span> isinstance(input, list):  <span class="comment"># 当前节点是叶节点</span></span><br><span class="line">        current_node = self.add_node(layer, tag=input)</span><br><span class="line">    <span class="keyword">elif</span> layer &gt;= self.depth_limit:</span><br><span class="line">        child_list = self.flat_list(input)</span><br><span class="line">        left_list = child_list[:int(len(child_list) / <span class="number">2</span>)]</span><br><span class="line">        right_list = child_list[int(len(child_list) / <span class="number">2</span>):]</span><br><span class="line">        child_node_list = list()</span><br><span class="line">        <span class="keyword">for</span> leaf <span class="keyword">in</span> left_list:  <span class="comment"># 左子树</span></span><br><span class="line">            child_node = self.list_to_tree(leaf, layer + <span class="number">1</span>)</span><br><span class="line">            child_node_list.append(child_node)</span><br><span class="line">        current_node = self.add_node(layer, tag=<span class="keyword">None</span>)  <span class="comment"># 多叉树，但还是要保持中序（为了美观）</span></span><br><span class="line">        <span class="keyword">for</span> leaf <span class="keyword">in</span> right_list:  <span class="comment"># 右子树</span></span><br><span class="line">            child_node = self.list_to_tree(leaf, layer + <span class="number">1</span>)</span><br><span class="line">            child_node_list.append(child_node)</span><br><span class="line">        <span class="keyword">for</span> child_node <span class="keyword">in</span> child_node_list:</span><br><span class="line">            self.graph.add_edge(child_node, current_node)</span><br><span class="line">    <span class="keyword">return</span> current_node</span><br></pre></td></tr></table></figure>
<p>上面有一个参数是self.depth_limit，用来指定最大深度。如果超过最大深度影响可视化效果，则将当前列表的子列表摊平，转换为多叉树。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flat_list</span><span class="params">(self, the_list)</span>:</span></span><br><span class="line">    now = the_list[:]</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">while</span> now:</span><br><span class="line">        head = now.pop(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> isinstance(head, list):</span><br><span class="line">            now = head + now</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            res.append(head)</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>
<p>添加节点的函数如下。networkx的nodes列表可以遍历所有的node。我们用是否有tag属性区分叶子节点和中间节点。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_node</span><span class="params">(self, layer, tag)</span>:</span></span><br><span class="line">    self.graph.add_node(self.counter)</span><br><span class="line">    <span class="keyword">if</span> tag <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:  <span class="comment"># 叶子</span></span><br><span class="line">        self.graph.nodes[self.counter][<span class="string">'tag'</span>] = tag</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:  <span class="comment"># 中间节点</span></span><br><span class="line">        self.graph.nodes[self.counter][<span class="string">'tag'</span>] = <span class="string">""</span></span><br><span class="line">    self.graph.nodes[self.counter][<span class="string">'layer'</span>] = layer</span><br><span class="line">    self.graph.nodes[self.counter][<span class="string">'sequence_index'</span>] = self.sequence_index</span><br><span class="line">    self.counter += <span class="number">1</span>  <span class="comment"># 更新counter标记</span></span><br><span class="line">    self.sequence_index += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> self.counter - <span class="number">1</span>  <span class="comment"># 返回这次添加的counter_id</span></span><br></pre></td></tr></table></figure>
<p>如果这棵二叉树不想保留sustain（或者rest），那么提前执行下面函数，改写list：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reshape_list</span><span class="params">(self, input_list)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> isinstance(input_list[<span class="number">0</span>], list): <span class="comment"># 递归地解决左子树</span></span><br><span class="line">        input_list[<span class="number">0</span>] = self.reshape_list(input_list[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> isinstance(input_list[<span class="number">1</span>], list): <span class="comment"># 递归地解决右子树</span></span><br><span class="line">        input_list[<span class="number">1</span>] = self.reshape_list(input_list[<span class="number">1</span>])</span><br><span class="line">    <span class="comment"># 边界有几种情况：都不删，都删，和只删一边</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isinstance(input_list[<span class="number">0</span>], list) <span class="keyword">and</span> <span class="keyword">not</span> isinstance(input_list[<span class="number">1</span>], list): <span class="comment"># 两个子树都为叶子节点，边界条件</span></span><br><span class="line">        <span class="keyword">if</span> input_list[<span class="number">0</span>] == <span class="string">"-"</span> <span class="keyword">and</span> input_list[<span class="number">1</span>] == <span class="string">"-"</span>:  <span class="comment"># 都删需要满足两边都是叶子</span></span><br><span class="line">            <span class="keyword">return</span> _sustain</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isinstance(input_list[<span class="number">0</span>], list):</span><br><span class="line">        <span class="keyword">if</span> input_list[<span class="number">0</span>] == <span class="string">"-"</span>: <span class="comment"># 删左边需要保证左边是叶子</span></span><br><span class="line">            <span class="keyword">return</span> input_list[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isinstance(input_list[<span class="number">1</span>], list):</span><br><span class="line">        <span class="keyword">if</span> input_list[<span class="number">1</span>] == <span class="string">"-"</span>: <span class="comment"># 删右边需要保证右边是叶子</span></span><br><span class="line">            <span class="keyword">return</span> input_list[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> input_list</span><br></pre></td></tr></table></figure>
<p>最后执行绘画函数。先计算总长度。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">max_layer = max([self.graph.nodes[k][<span class="string">'layer'</span>] <span class="keyword">for</span> k <span class="keyword">in</span> list(self.graph.nodes)])</span><br><span class="line">sequence_len = max([self.graph.nodes[k][<span class="string">'sequence_index'</span>] <span class="keyword">for</span> k <span class="keyword">in</span> list(self.graph.nodes)]) + <span class="number">1</span></span><br><span class="line">leaf_len = len([self.graph.nodes[k] <span class="keyword">for</span> k <span class="keyword">in</span> list(self.graph.nodes) <span class="keyword">if</span> self.graph.nodes[k][<span class="string">'tag'</span>] != <span class="string">''</span>])</span><br></pre></td></tr></table></figure>
<p>为了看上去比较舒服，我将每四个音符聚在了一起，使用了blank_counter变量修正位置。如果不需要做这样的聚合，可以直接去掉这个变量。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> self.reschedule_index:  <span class="comment"># 将子树尝试均匀排列</span></span><br><span class="line">    position_counter = <span class="number">0</span></span><br><span class="line">    beat_flag = <span class="number">4</span></span><br><span class="line">    blank_counter = <span class="number">0</span></span><br><span class="line">    bar_flag = leaf_len / <span class="number">4</span></span><br><span class="line">    <span class="keyword">for</span> leaf_index <span class="keyword">in</span> range(sequence_len):  <span class="comment"># 先修正最底层</span></span><br><span class="line">        <span class="keyword">if</span> self.graph.nodes[leaf_index][<span class="string">'tag'</span>] != <span class="string">''</span>:</span><br><span class="line">            self.graph.nodes[leaf_index][<span class="string">'sequence_index'</span>] = position_counter</span><br><span class="line">            position_counter += <span class="number">1</span></span><br><span class="line">            position_counter += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> (position_counter - blank_counter) % beat_flag == <span class="number">0</span>:</span><br><span class="line">                position_counter += <span class="number">1</span></span><br><span class="line">                blank_counter += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> (position_counter - blank_counter) % bar_flag == <span class="number">0</span>:</span><br><span class="line">                position_counter += <span class="number">1</span></span><br><span class="line">                blank_counter += <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>为了可视化，我们先固定最底层的所有叶子节点。一个明确的原则是，顶层节点的位置应由其子树的位置决定。任何子树的根节点都应该在它左孩子和右孩子连线的垂直平分线上。于是逐层向上修正节点位置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 反过来修正上面所有层数</span></span><br><span class="line"><span class="keyword">for</span> layer_index <span class="keyword">in</span> range(max_layer):  <span class="comment"># 0 to max_layer - 1</span></span><br><span class="line">    current_layer = max_layer - layer_index  <span class="comment"># reverse</span></span><br><span class="line">    <span class="comment"># 寻找直接子节点</span></span><br><span class="line">    <span class="keyword">for</span> node_index <span class="keyword">in</span> range(sequence_len):</span><br><span class="line">        <span class="keyword">if</span> self.graph.nodes[node_index][<span class="string">'layer'</span>] == current_layer <span class="keyword">and</span> self.graph.nodes[node_index][</span><br><span class="line">            <span class="string">'tag'</span>] == <span class="string">''</span>:  <span class="comment"># 中间节点</span></span><br><span class="line">            position_list = list()</span><br><span class="line">            adj_node_list = list(self.graph.adj[node_index].keys())</span><br><span class="line">            positions = [self.graph.nodes[node][<span class="string">'sequence_index'</span>] <span class="keyword">for</span> node <span class="keyword">in</span> adj_node_list</span><br><span class="line">                            <span class="keyword">if</span> self.graph.nodes[node][<span class="string">'layer'</span>] == current_layer + <span class="number">1</span>]</span><br><span class="line">            self.graph.nodes[node_index][<span class="string">'sequence_index'</span>] = sum(positions) / len(positions)</span><br></pre></td></tr></table></figure>
<p>最后绘画：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    fig = plt.figure(figsize=(int(sequence_len / <span class="number">4</span>), int(max_layer)))</span><br><span class="line">    pic = nx.draw_networkx(self.graph,</span><br><span class="line">                            pos=&#123;</span><br><span class="line">                                k: (self.graph.nodes[k][<span class="string">'sequence_index'</span>],</span><br><span class="line">                                    (max_layer + <span class="number">1</span>) - self.graph.nodes[k][<span class="string">'layer'</span>])</span><br><span class="line">                                <span class="keyword">if</span> self.graph.nodes[k][<span class="string">'tag'</span>] == <span class="string">""</span></span><br><span class="line">                                <span class="keyword">else</span> (self.graph.nodes[k][<span class="string">'sequence_index'</span>], <span class="number">0</span>)</span><br><span class="line">                                <span class="keyword">for</span> k <span class="keyword">in</span> list(self.graph.nodes)</span><br><span class="line">                            &#125;,</span><br><span class="line">                            labels=&#123;</span><br><span class="line">                                k: self.graph.nodes[k][<span class="string">'tag'</span>]</span><br><span class="line">                                <span class="keyword">for</span> k <span class="keyword">in</span> list(self.graph.nodes)</span><br><span class="line">                                <span class="keyword">if</span> self.graph.nodes[k][<span class="string">'tag'</span>] != <span class="string">""</span></span><br><span class="line">                            &#125;,</span><br><span class="line">                            font_size=<span class="number">9</span>,</span><br><span class="line">                            node_size=<span class="number">250</span>,</span><br><span class="line">                            node_color=<span class="string">'gold'</span>,</span><br><span class="line">                            edge_color=<span class="string">'silver'</span>,</span><br><span class="line">                            width=<span class="number">3</span>,</span><br><span class="line">                            )</span><br><span class="line">    plt.tight_layout()</span><br><span class="line">    plt.savefig(output_dir)</span><br><span class="line">    plt.close(fig)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(e.args)</span><br></pre></td></tr></table></figure>
<p>这一段可能报错的原因很多。如果需要连续反复调用这个函数，那么一个报错很可能打断程序运行。我在这里设置了exception，为了一张图的出错不影响整体程序推进。</p>
<p>完整程序如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"><span class="keyword">import</span> pretty_midi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreePainter</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, input_list, output_file, paint = True)</span>:</span></span><br><span class="line">        self.origin_list = input_list</span><br><span class="line">        self.counter = <span class="number">0</span>  <span class="comment"># 为节点命名，将和弦符号定义为其属性</span></span><br><span class="line">        self.sequence_index = <span class="number">0</span></span><br><span class="line">        self.vertical = <span class="keyword">False</span></span><br><span class="line">        self.color = <span class="string">'positive'</span>  <span class="comment"># color tags &gt; 0</span></span><br><span class="line">        self.depth_limit = <span class="number">10</span></span><br><span class="line">        self.reschedule_index = <span class="keyword">True</span></span><br><span class="line">        self.graph = nx.Graph()</span><br><span class="line">        self.note_name = <span class="keyword">False</span></span><br><span class="line">        self.ignore_sustain = <span class="keyword">False</span></span><br><span class="line">        self.ignore_rest = <span class="keyword">False</span></span><br><span class="line">        self.midi = <span class="keyword">False</span></span><br><span class="line">        self.paint = paint</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Action</span></span><br><span class="line">        <span class="keyword">if</span> self.ignore_sustain:</span><br><span class="line">            self.origin_list = self.reshape_list(self.origin_list)</span><br><span class="line">        <span class="keyword">if</span> self.paint:</span><br><span class="line">            self.list_to_tree(self.origin_list, layer=<span class="number">0</span>)</span><br><span class="line">            self.paint_tree(output_file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reshape_list</span><span class="params">(self, input_list)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> isinstance(input_list[<span class="number">0</span>], list): <span class="comment"># 递归地解决左子树</span></span><br><span class="line">            input_list[<span class="number">0</span>] = self.reshape_list(input_list[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> isinstance(input_list[<span class="number">1</span>], list): <span class="comment"># 递归地解决右子树</span></span><br><span class="line">            input_list[<span class="number">1</span>] = self.reshape_list(input_list[<span class="number">1</span>])</span><br><span class="line">        <span class="comment"># 边界有几种情况：都不删，都删，和只删一边</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(input_list[<span class="number">0</span>], list) <span class="keyword">and</span> <span class="keyword">not</span> isinstance(input_list[<span class="number">1</span>], list): <span class="comment"># 两个子树都为叶子节点，边界条件</span></span><br><span class="line">            <span class="keyword">if</span> input_list[<span class="number">0</span>] == <span class="string">"-"</span> <span class="keyword">and</span> input_list[<span class="number">1</span>] == <span class="string">"-"</span>:  <span class="comment"># 都删需要满足两边都是叶子</span></span><br><span class="line">                <span class="keyword">return</span> _sustain</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(input_list[<span class="number">0</span>], list):</span><br><span class="line">            <span class="keyword">if</span> input_list[<span class="number">0</span>] == <span class="string">"-"</span>: <span class="comment"># 删左边需要保证左边是叶子</span></span><br><span class="line">                <span class="keyword">return</span> input_list[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(input_list[<span class="number">1</span>], list):</span><br><span class="line">            <span class="keyword">if</span> input_list[<span class="number">1</span>] == <span class="string">"-"</span>: <span class="comment"># 删右边需要保证右边是叶子</span></span><br><span class="line">                <span class="keyword">return</span> input_list[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> input_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">flat_list</span><span class="params">(self, the_list)</span>:</span></span><br><span class="line">        now = the_list[:]</span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">while</span> now:</span><br><span class="line">            head = now.pop(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> isinstance(head, list):</span><br><span class="line">                now = head + now</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res.append(head)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">list_to_tree</span><span class="params">(self, input, layer)</span>:</span>  <span class="comment"># 递归地添加所有节点，做成中序树</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(input, list) <span class="keyword">and</span> layer &lt; self.depth_limit:  <span class="comment"># 当前节点不是叶节点 ，或深度没有到达限制</span></span><br><span class="line">            left_node = self.list_to_tree(input[<span class="number">0</span>], layer + <span class="number">1</span>)  <span class="comment"># 左子树，返回子树的root</span></span><br><span class="line">            current_node = self.add_node(layer, tag=<span class="keyword">None</span>)  <span class="comment"># 当前节点</span></span><br><span class="line">            right_node = self.list_to_tree(input[<span class="number">1</span>], layer + <span class="number">1</span>)  <span class="comment"># 右子树，返回子树的root</span></span><br><span class="line">            self.graph.add_edge(left_node, current_node)</span><br><span class="line">            self.graph.add_edge(right_node, current_node)</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> isinstance(input, list):  <span class="comment"># 当前节点是叶节点</span></span><br><span class="line">            current_node = self.add_node(layer, tag=input)</span><br><span class="line">        <span class="keyword">elif</span> layer &gt;= self.depth_limit:</span><br><span class="line">            child_list = self.flat_list(input)</span><br><span class="line">            left_list = child_list[:int(len(child_list) / <span class="number">2</span>)]</span><br><span class="line">            right_list = child_list[int(len(child_list) / <span class="number">2</span>):]</span><br><span class="line">            child_node_list = list()</span><br><span class="line">            <span class="keyword">for</span> leaf <span class="keyword">in</span> left_list:  <span class="comment"># 左子树</span></span><br><span class="line">                child_node = self.list_to_tree(leaf, layer + <span class="number">1</span>)</span><br><span class="line">                child_node_list.append(child_node)</span><br><span class="line">            current_node = self.add_node(layer, tag=<span class="keyword">None</span>)  <span class="comment"># 多叉树，但还是要保持中序（为了美观）</span></span><br><span class="line">            <span class="keyword">for</span> leaf <span class="keyword">in</span> right_list:  <span class="comment"># 右子树</span></span><br><span class="line">                child_node = self.list_to_tree(leaf, layer + <span class="number">1</span>)</span><br><span class="line">                child_node_list.append(child_node)</span><br><span class="line">            <span class="keyword">for</span> child_node <span class="keyword">in</span> child_node_list:</span><br><span class="line">                self.graph.add_edge(child_node, current_node)</span><br><span class="line">        <span class="keyword">return</span> current_node</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_node</span><span class="params">(self, layer, tag)</span>:</span></span><br><span class="line">        self.graph.add_node(self.counter)</span><br><span class="line">        <span class="keyword">if</span> tag <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>:  <span class="comment"># 叶子</span></span><br><span class="line">            self.graph.nodes[self.counter][<span class="string">'tag'</span>] = tag</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># 中间节点</span></span><br><span class="line">            self.graph.nodes[self.counter][<span class="string">'tag'</span>] = <span class="string">""</span></span><br><span class="line">        self.graph.nodes[self.counter][<span class="string">'layer'</span>] = layer</span><br><span class="line">        self.graph.nodes[self.counter][<span class="string">'sequence_index'</span>] = self.sequence_index</span><br><span class="line">        self.counter += <span class="number">1</span>  <span class="comment"># 更新counter标记</span></span><br><span class="line">        self.sequence_index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self.counter - <span class="number">1</span>  <span class="comment"># 返回这次添加的counter_id</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">paint_tree</span><span class="params">(self, output_dir)</span>:</span></span><br><span class="line">        max_layer = max([self.graph.nodes[k][<span class="string">'layer'</span>] <span class="keyword">for</span> k <span class="keyword">in</span> list(self.graph.nodes)])</span><br><span class="line">        sequence_len = max([self.graph.nodes[k][<span class="string">'sequence_index'</span>] <span class="keyword">for</span> k <span class="keyword">in</span> list(self.graph.nodes)]) + <span class="number">1</span></span><br><span class="line">        leaf_len = len([self.graph.nodes[k] <span class="keyword">for</span> k <span class="keyword">in</span> list(self.graph.nodes) <span class="keyword">if</span> self.graph.nodes[k][<span class="string">'tag'</span>] != <span class="string">''</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.reschedule_index:  <span class="comment"># 将子树尝试均匀排列</span></span><br><span class="line">            position_counter = <span class="number">0</span></span><br><span class="line">            beat_flag = <span class="number">4</span></span><br><span class="line">            blank_counter = <span class="number">0</span></span><br><span class="line">            bar_flag = leaf_len / <span class="number">4</span></span><br><span class="line">            <span class="keyword">for</span> leaf_index <span class="keyword">in</span> range(sequence_len):  <span class="comment"># 先修正最底层</span></span><br><span class="line">                <span class="keyword">if</span> self.graph.nodes[leaf_index][<span class="string">'tag'</span>] != <span class="string">''</span>:</span><br><span class="line">                    self.graph.nodes[leaf_index][<span class="string">'sequence_index'</span>] = position_counter</span><br><span class="line">                    position_counter += <span class="number">1</span></span><br><span class="line">                    position_counter += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">if</span> (position_counter - blank_counter) % beat_flag == <span class="number">0</span>:</span><br><span class="line">                        position_counter += <span class="number">1</span></span><br><span class="line">                        blank_counter += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">if</span> (position_counter - blank_counter) % bar_flag == <span class="number">0</span>:</span><br><span class="line">                        position_counter += <span class="number">1</span></span><br><span class="line">                        blank_counter += <span class="number">1</span></span><br><span class="line">            <span class="comment"># 反过来修正上面所有层数</span></span><br><span class="line">            <span class="keyword">for</span> layer_index <span class="keyword">in</span> range(max_layer):  <span class="comment"># 0 to max_layer - 1</span></span><br><span class="line">                current_layer = max_layer - layer_index  <span class="comment"># reverse</span></span><br><span class="line">                <span class="comment"># 寻找直接子节点</span></span><br><span class="line">                <span class="keyword">for</span> node_index <span class="keyword">in</span> range(sequence_len):</span><br><span class="line">                    <span class="keyword">if</span> self.graph.nodes[node_index][<span class="string">'layer'</span>] == current_layer <span class="keyword">and</span> self.graph.nodes[node_index][</span><br><span class="line">                        <span class="string">'tag'</span>] == <span class="string">''</span>:  <span class="comment"># 中间节点</span></span><br><span class="line">                        position_list = list()</span><br><span class="line">                        adj_node_list = list(self.graph.adj[node_index].keys())</span><br><span class="line">                        positions = [self.graph.nodes[node][<span class="string">'sequence_index'</span>] <span class="keyword">for</span> node <span class="keyword">in</span> adj_node_list</span><br><span class="line">                                     <span class="keyword">if</span> self.graph.nodes[node][<span class="string">'layer'</span>] == current_layer + <span class="number">1</span>]</span><br><span class="line">                        self.graph.nodes[node_index][<span class="string">'sequence_index'</span>] = sum(positions) / len(positions)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            fig = plt.figure(figsize=(int(sequence_len / <span class="number">4</span>), int(max_layer)))</span><br><span class="line">            pic = nx.draw_networkx(self.graph,</span><br><span class="line">                                   pos=&#123;</span><br><span class="line">                                       k: (self.graph.nodes[k][<span class="string">'sequence_index'</span>],</span><br><span class="line">                                           (max_layer + <span class="number">1</span>) - self.graph.nodes[k][<span class="string">'layer'</span>])</span><br><span class="line">                                       <span class="keyword">if</span> self.graph.nodes[k][<span class="string">'tag'</span>] == <span class="string">""</span></span><br><span class="line">                                       <span class="keyword">else</span> (self.graph.nodes[k][<span class="string">'sequence_index'</span>], <span class="number">0</span>)</span><br><span class="line">                                       <span class="keyword">for</span> k <span class="keyword">in</span> list(self.graph.nodes)</span><br><span class="line">                                   &#125;,</span><br><span class="line">                                   labels=&#123;</span><br><span class="line">                                       k: self.graph.nodes[k][<span class="string">'tag'</span>]</span><br><span class="line">                                       <span class="keyword">for</span> k <span class="keyword">in</span> list(self.graph.nodes)</span><br><span class="line">                                       <span class="keyword">if</span> self.graph.nodes[k][<span class="string">'tag'</span>] != <span class="string">""</span></span><br><span class="line">                                   &#125;,</span><br><span class="line">                                   font_size=<span class="number">9</span>,</span><br><span class="line">                                   node_size=<span class="number">250</span>,</span><br><span class="line">                                   node_color=<span class="string">'gold'</span>,</span><br><span class="line">                                   edge_color=<span class="string">'silver'</span>,</span><br><span class="line">                                   width=<span class="number">3</span>,</span><br><span class="line">                                   )</span><br><span class="line">            <span class="comment">#</span></span><br><span class="line">            <span class="comment"># if self.vertical:</span></span><br><span class="line">            <span class="comment">#     for _, item in pic.item():</span></span><br><span class="line">            <span class="comment">#         item.set_rotation('vertical')</span></span><br><span class="line"></span><br><span class="line">            plt.tight_layout()</span><br><span class="line">            plt.savefig(output_dir)</span><br><span class="line">            plt.close(fig)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e.args)</span><br></pre></td></tr></table></figure>
<p>测试程序如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">parse_tree = [[[[[[[<span class="string">"G4"</span>, <span class="string">"-"</span>], [[[<span class="string">"-"</span>, <span class="string">"-"</span>], [<span class="string">"F4"</span>, <span class="string">"-"</span>]], <span class="string">"G4"</span>]], <span class="string">"-"</span>], [[<span class="string">"A#4"</span>, <span class="string">"-"</span>], [<span class="string">"-"</span>, <span class="string">"-"</span>]]], [[[<span class="string">"C5"</span>, <span class="string">"-"</span>], [<span class="string">"F4"</span>, <span class="string">"-"</span>]], [[[[<span class="string">"G4"</span>, <span class="string">"-"</span>], [<span class="string">"-"</span>, <span class="string">"-"</span>]], [<span class="string">" "</span>, <span class="string">" "</span>]], [[[[<span class="string">" "</span>, <span class="string">" "</span>], [<span class="string">"D4"</span>, <span class="string">"-"</span>]], [[<span class="string">"-"</span>, <span class="string">"-"</span>], [<span class="string">"-"</span>, <span class="string">"-"</span>]]], [[<span class="string">"A#4"</span>, <span class="string">"-"</span>], [<span class="string">"G4"</span>, <span class="string">"-"</span>]]]]]], [[[<span class="string">"-"</span>, <span class="string">"-"</span>], [<span class="string">"F4"</span>, <span class="string">"-"</span>]], [[<span class="string">"-"</span>, <span class="string">"-"</span>], [<span class="string">"D4"</span>, <span class="string">"-"</span>]]]], [[[[[<span class="string">"C4"</span>, <span class="string">"-"</span>], [<span class="string">"A#3"</span>, <span class="string">"-"</span>]], [[[[[<span class="string">"-"</span>, <span class="string">"-"</span>], [<span class="string">"C4"</span>, <span class="string">"-"</span>]], [[<span class="string">"-"</span>, <span class="string">"-"</span>], [<span class="string">" "</span>, <span class="string">" "</span>]]], <span class="string">" "</span>], <span class="string">" "</span>]], [[<span class="string">"C4"</span>, <span class="string">"-"</span>], [<span class="string">"-"</span>, <span class="string">"-"</span>]]], [[<span class="string">"-"</span>, <span class="string">"-"</span>], [<span class="string">"D4"</span>, <span class="string">"-"</span>]]]]</span><br><span class="line">s = TreePainter(parse_tree, <span class="string">'1.png'</span>)</span><br></pre></td></tr></table></figure>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2020-01-13T07:36:18.000Z" itemprop="dateUpdated">2020-01-13 07:36:18</time>
</span><br>


        
        原文地址：<a href="/2020/01/13/binary-tree/" target="_blank" rel="external">http://ldzhangyx.github.io/2020/01/13/binary-tree/</a>
        
    </div>
    
    <footer>
        <a href="http://ldzhangyx.github.io">
            <img src="/img/avatar.jpg" alt="张逸霄">
            张逸霄
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MIR/">MIR</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/networkx/">networkx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/structure/">structure</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://ldzhangyx.github.io/2020/01/13/binary-tree/&title=《利用networkx进行二叉树可视化》 — 张逸霄的技术小站&pic=http://ldzhangyx.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://ldzhangyx.github.io/2020/01/13/binary-tree/&title=《利用networkx进行二叉树可视化》 — 张逸霄的技术小站&source=画一棵二叉树。附可执行的Python代码。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://ldzhangyx.github.io/2020/01/13/binary-tree/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《利用networkx进行二叉树可视化》 — 张逸霄的技术小站&url=http://ldzhangyx.github.io/2020/01/13/binary-tree/&via=http://ldzhangyx.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://ldzhangyx.github.io/2020/01/13/binary-tree/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2020/02/07/diora-urnng/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">无监督句法分析：《Unsupervised Latent Tree Induction with Deep Inside-Outside Recursive Auto-Encoders》论文笔记</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/01/13/music-practice/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">借助pretty_midi包进行数据格式转换</h4>
      </a>
    </div>
  
</nav>



    

















    <section class="comments" id="comments">
        <div id="gitalk-container"></div>
        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
        <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
        <script>
            var id = location.pathname
            if (location.pathname.length > 50) {
              id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
            }
            const gitalk = new Gitalk({
              clientID: '2fe1bcc914de92fd5141',
              clientSecret: '38e2830b66e3ce7e3a8b21cc86bbd2b715f6b2e3',
              accessToken: '6d91fb0c829c1a9b85219dd747aa5952fd3ec312',
              repo: 'ldzhangyx.github.io',
              owner: 'ldzhangyx',
              admin: ['ldzhangyx'],
              id: id,      // Ensure uniqueness and length less than 50
              title: document.title.split('|')[0],
              distractionFreeMode: false  // Facebook-like distraction free mode
            })
            gitalk.render('gitalk-container')
        </script>
    </section>
    


</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        非常感谢~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>张逸霄 &copy; 2017 - 2020</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://ldzhangyx.github.io/2020/01/13/binary-tree/&title=《利用networkx进行二叉树可视化》 — 张逸霄的技术小站&pic=http://ldzhangyx.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://ldzhangyx.github.io/2020/01/13/binary-tree/&title=《利用networkx进行二叉树可视化》 — 张逸霄的技术小站&source=画一棵二叉树。附可执行的Python代码。" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://ldzhangyx.github.io/2020/01/13/binary-tree/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《利用networkx进行二叉树可视化》 — 张逸霄的技术小站&url=http://ldzhangyx.github.io/2020/01/13/binary-tree/&via=http://ldzhangyx.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://ldzhangyx.github.io/2020/01/13/binary-tree/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMklEQVR42u3aS1LDMBAFwNz/0mbLInHeGxmqLLdWVAi2WothPnq94nX8Wp8+Sb6/8swLFgYGxm0Zx+lKtnWO+fSW82/me8PAwHgOI9lEG1iTINuG6Y+fY2BgYMQBMdncVceHgYGB0QbcPKE8L1MxMDAwVorYthw9/37yzD+pxTEwMG7IyLvu///zn8w3MDAwbsU4ypUHxzZc5n/15jkYGBhbM/IA1yaCbbmbPOHLfjAwMDZlzBpqefrYFpzDi2IYGBhbM9ZHle0Y4Dxwz1p+GBgYz2Hkm0iSwrZ8bVtvGBgYz2TMisk2sZsdWZSqYmBgbMqYNb/aYjVJ9Vp2XWdjYGDcnNH2rNqbD3ljrg36bwYDGBgY2zHa2JUEyjzJaw+iGBhgYGBsxGivas1+OxugJocVxXgMDIybM/LwlydqKy/LL5/VCwMD47aMPKjl18LyoWOeAkapIQYGxqaM2UhypT03uyh2wX8MDAyM2zJmI8MjXrOtJweBgYHxHEZbmrbF6myEkF/vwMDAeCbj2qCZt9IuCMoYGBgPYCSPy5tuK026/JPXLJZjYGBswZhdoWhb/LNhZ31zBAMD4+aMo1yzUnO9SB4mhRgYGFswZuPM9gJE+/qLL1tgYGBswciDbJsmzk5ueGQYGBgPYOSB76oh5SzV+1KLY2BgYCwUk0m7bSXEY2BgYOQt/lnLbOV6GQYGxnMYs2FAsqHzIcFl1zgwMDC2ZrSJXVtqthcsWgwGBsbWjB9sdZNh0ieg+wAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdnjs.cloudflare.com/ajax/libs/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" async></script>




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'Yixiao Zhang's Website';
            clearTimeout(titleTime);
        } else {
            document.title = 'Yixiao Zhang's Website';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>
